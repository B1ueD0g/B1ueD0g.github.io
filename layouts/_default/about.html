{{- define "main" }}
{{- $aboutData := site.Data.about -}}
{{- $useProfileData := .Param "useProfileData" | default false -}}
<article class="post-single about-single about-pro">
  <header class="post-header">
    <h1 class="post-title entry-hint-parent">{{ .Title }}</h1>
    {{- with .Description }}
    <div class="post-description">{{ . }}</div>
    {{- end }}
    <div class="about-social">
      {{- partial "social_icons.html" (dict "align" "left") -}}
    </div>
  </header>

  {{- if and $useProfileData $aboutData }}
  <div class="about-profile">
    {{- with $aboutData.profile.roles }}
    <section class="about-block about-block-title">
      <h2>{{ $aboutData.profile.title | default "Title" }}</h2>
      <ul class="about-title-list">
        {{- range . }}
        <li>{{ . }}</li>
        {{- end }}
      </ul>
    </section>
    {{- end }}

    {{- with $aboutData.highlights }}
    <section class="about-block about-block-highlights">
      <h2>Highlights · 亮点</h2>
      <ul class="about-highlight-list">
        {{- range . }}
        <li>{{ . }}</li>
        {{- end }}
      </ul>
    </section>
    {{- end }}

    {{- with $aboutData.certifications }}
    <section class="about-block about-block-certifications">
      <h2>Certifications · 证书</h2>
      <ul class="about-cert-list">
        {{- range . }}
        <li>{{ . }}</li>
        {{- end }}
      </ul>
    </section>
    {{- end }}

    {{- with $aboutData.honors }}
    <section class="about-block about-block-honors">
      <h2>Honors · 荣誉</h2>
      <ul class="about-honor-list">
        {{- range . }}
        <li>{{ . }}</li>
        {{- end }}
      </ul>
    </section>
    {{- end }}

    {{- with $aboutData.works }}
    {{- $published := where . "type" "in" (slice "编写-书籍" "翻译-书籍" "编制-标准") -}}
    {{- $inProgress := where . "type" "in" (slice "编写-书籍（待出版）" "翻译-书籍（待出版）" "编制-标准（待发布）") -}}
    {{- $translatedReferences := where . "type" "in" (slice "翻译-标准" "翻译-白皮书" "翻译-报告") -}}
    {{- $defaultPanel := "published" -}}
    {{- if and (eq (len $published) 0) (gt (len $inProgress) 0) -}}
    {{- $defaultPanel = "inprogress" -}}
    {{- else if and (eq (len $published) 0) (eq (len $inProgress) 0) (gt (len $translatedReferences) 0) -}}
    {{- $defaultPanel = "translated" -}}
    {{- end -}}
    <section class="about-block about-block-works">
      <h2>Works · 成果物</h2>
      <div class="about-work-tabs" role="tablist" aria-label="Works tabs">
        {{- if gt (len $published) 0 }}
        <button class="about-work-tab{{ if eq $defaultPanel "published" }} is-active{{ end }}" type="button" role="tab" data-target="published" aria-selected="{{ if eq $defaultPanel "published" }}true{{ else }}false{{ end }}" aria-controls="about-work-panel-published">已发布（书籍 / 标准）</button>
        {{- end }}
        {{- if gt (len $inProgress) 0 }}
        <button class="about-work-tab{{ if eq $defaultPanel "inprogress" }} is-active{{ end }}" type="button" role="tab" data-target="inprogress" aria-selected="{{ if eq $defaultPanel "inprogress" }}true{{ else }}false{{ end }}" aria-controls="about-work-panel-inprogress">待出版 / 待发布（书籍 / 标准）</button>
        {{- end }}
        {{- if gt (len $translatedReferences) 0 }}
        <button class="about-work-tab{{ if eq $defaultPanel "translated" }} is-active{{ end }}" type="button" role="tab" data-target="translated" aria-selected="{{ if eq $defaultPanel "translated" }}true{{ else }}false{{ end }}" aria-controls="about-work-panel-translated">翻译标准/白皮书/报告（节选）</button>
        {{- end }}
      </div>
      <div class="about-work-panels">
        {{- if gt (len $published) 0 }}
        <section class="about-work-panel{{ if eq $defaultPanel "published" }} is-active{{ end }}" id="about-work-panel-published" data-panel="published" role="tabpanel">
          <ul class="about-work-list">
            {{- range $published }}
            {{- $typeClass := "about-work-type-translation" -}}
            {{- if in (slice "编写-书籍" "翻译-书籍" "编写-书籍（待出版）" "翻译-书籍（待出版）") .type -}}
            {{- $typeClass = "about-work-type-book" -}}
            {{- else if in (slice "编制-标准" "编制-标准（待发布）") .type -}}
            {{- $typeClass = "about-work-type-standard" -}}
            {{- end -}}
            <li class="about-work-item">
              <span class="about-work-type {{ $typeClass }}">{{ .type }}</span>
              <div class="about-work-main">
                {{- if .url }}
                <a class="about-work-title" href="{{ .url }}" target="_blank" rel="noopener noreferrer">{{ .title }}</a>
                <a class="about-work-open" href="{{ .url }}" target="_blank" rel="noopener noreferrer" aria-label="打开成果物链接"><span class="about-work-arrow" aria-hidden="true">↗</span></a>
                {{- else }}
                <span class="about-work-title">{{ .title }}</span>
                {{- end }}
              </div>
            </li>
            {{- end }}
          </ul>
        </section>
        {{- end }}
        {{- if gt (len $inProgress) 0 }}
        <section class="about-work-panel{{ if eq $defaultPanel "inprogress" }} is-active{{ end }}" id="about-work-panel-inprogress" data-panel="inprogress" role="tabpanel">
          <ul class="about-work-list">
            {{- range $inProgress }}
            {{- $typeClass := "about-work-type-translation" -}}
            {{- if in (slice "编写-书籍" "翻译-书籍" "编写-书籍（待出版）" "翻译-书籍（待出版）") .type -}}
            {{- $typeClass = "about-work-type-book" -}}
            {{- else if in (slice "编制-标准" "编制-标准（待发布）") .type -}}
            {{- $typeClass = "about-work-type-standard" -}}
            {{- end -}}
            <li class="about-work-item">
              <span class="about-work-type {{ $typeClass }}">{{ .type }}</span>
              <div class="about-work-main">
                {{- if .url }}
                <a class="about-work-title" href="{{ .url }}" target="_blank" rel="noopener noreferrer">{{ .title }}</a>
                <a class="about-work-open" href="{{ .url }}" target="_blank" rel="noopener noreferrer" aria-label="打开成果物链接"><span class="about-work-arrow" aria-hidden="true">↗</span></a>
                {{- else }}
                <span class="about-work-title">{{ .title }}</span>
                {{- end }}
              </div>
            </li>
            {{- end }}
          </ul>
        </section>
        {{- end }}
        {{- if gt (len $translatedReferences) 0 }}
        <section class="about-work-panel{{ if eq $defaultPanel "translated" }} is-active{{ end }}" id="about-work-panel-translated" data-panel="translated" role="tabpanel">
          <ul class="about-work-list">
            {{- range $translatedReferences }}
            {{- $typeClass := "about-work-type-translation" -}}
            {{- if in (slice "编写-书籍" "翻译-书籍" "编写-书籍（待出版）" "翻译-书籍（待出版）") .type -}}
            {{- $typeClass = "about-work-type-book" -}}
            {{- else if in (slice "编制-标准" "编制-标准（待发布）") .type -}}
            {{- $typeClass = "about-work-type-standard" -}}
            {{- end -}}
            <li class="about-work-item">
              <span class="about-work-type {{ $typeClass }}">{{ .type }}</span>
              <div class="about-work-main">
                {{- if .url }}
                <a class="about-work-title" href="{{ .url }}" target="_blank" rel="noopener noreferrer">{{ .title }}</a>
                <a class="about-work-open" href="{{ .url }}" target="_blank" rel="noopener noreferrer" aria-label="打开成果物链接"><span class="about-work-arrow" aria-hidden="true">↗</span></a>
                {{- else }}
                <span class="about-work-title">{{ .title }}</span>
                {{- end }}
              </div>
            </li>
            {{- end }}
          </ul>
        </section>
        {{- end }}
      </div>
      {{- with $aboutData.translation_note }}
      <p class="about-translation-note">{{ . }}</p>
      {{- end }}
    </section>
    <script>
      (function () {
        const works = document.querySelector(".about-block-works");
        if (!works) return;
        const tabs = Array.from(works.querySelectorAll(".about-work-tab"));
        const panels = Array.from(works.querySelectorAll(".about-work-panel"));
        if (!tabs.length || !panels.length) return;
        const activate = (target) => {
          tabs.forEach((tab) => {
            const isActive = tab.dataset.target === target;
            tab.classList.toggle("is-active", isActive);
            tab.setAttribute("aria-selected", isActive ? "true" : "false");
          });
          panels.forEach((panel) => {
            panel.classList.toggle("is-active", panel.dataset.panel === target);
          });
        };
        tabs.forEach((tab) => {
          tab.addEventListener("click", () => activate(tab.dataset.target));
        });
      })();
    </script>
    {{- end }}

    {{- with $aboutData.roadmap }}
    <section class="about-block">
      <h2>Next · 进行中</h2>
      <ul class="about-list">
        {{- range . }}
        <li>{{ . }}</li>
        {{- end }}
      </ul>
    </section>
    {{- end }}
  </div>
  {{- else if .Content }}
  <div class="post-content">
    {{- if not (.Param "disableAnchoredHeadings") }}
    {{- partial "anchored_headings.html" .Content -}}
    {{- else -}}
    {{ .Content }}
    {{- end }}
  </div>
  {{- end }}
</article>
{{- end }}
